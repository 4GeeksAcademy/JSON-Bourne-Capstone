{"version":3,"file":"index.mjs","sources":["../src/index.js"],"sourcesContent":["const errorOverlayMiddleware = require('react-dev-utils/errorOverlayMiddleware')\n\nconst chunkPathBasic = require.resolve('./entries/basic.mjs')\nconst chunkPathDevServer = require.resolve('./entries/devserver.mjs')\n\nclass ErrorOverlayPlugin {\n  apply(compiler) {\n    const className = this.constructor.name\n\n    if (compiler.options.mode !== 'development') return\n\n    const devServerEnabled = !!compiler.options.devServer\n    const sockOptions = {}\n    if (devServerEnabled) {\n      // In the webpack config it's possible to override the websocket server's\n      // connect URL for clients that need to connect through a proxy or other means.\n      //\n      // Use a webSocketURL config if present, otherwise default to the same address\n      // as the devServer:\n      sockOptions.sockHost =\n        compiler.options.devServer.client?.webSocketURL?.hostname ||\n        compiler.options.devServer.host\n      sockOptions.sockPath =\n        compiler.options.devServer.client?.webSocketURL?.pathname ||\n        (compiler.options.devServer.webSocketServer === \"object\" && compiler.options.devServer.webSocketServer.options?.path) ||\n        '/ws'\n      sockOptions.sockPort =\n        compiler.options.devServer.client?.webSocketURL?.port ||\n        compiler.options.devServer.port\n    }\n\n    compiler.hooks.entryOption.tap(className, (context, entry) => {\n      adjustEntry(entry, devServerEnabled, sockOptions)\n    })\n\n    compiler.hooks.afterResolvers.tap(className, ({ options }) => {\n      if (devServerEnabled) {\n        const originalOnBeforeSetupMiddleware =\n          options.devServer.onBeforeSetupMiddleware\n        options.devServer.setupMiddlewares = (middlewares, devServer) => {\n          if (originalOnBeforeSetupMiddleware) {\n            originalOnBeforeSetupMiddleware(devServer)\n          }\n          middlewares.unshift(errorOverlayMiddleware());\n          return middlewares;\n        }\n      }\n    })\n  }\n}\n\nfunction adjustEntry(entry, enableDevServer, sockOptions) {\n  if (typeof entry === 'string') {\n    entry = [entry] // for anonymous single entry points\n  }\n\n  if (Array.isArray(entry)) {\n    if (enableDevServer) {\n      const sockHost = sockOptions.sockHost\n        ? `&sockHost=${sockOptions.sockHost}`\n        : ''\n      const sockPath = sockOptions.sockPath\n        ? `&sockPath=${sockOptions.sockPath}`\n        : ''\n      const sockPort = sockOptions.sockPort\n        ? `&sockPort=${sockOptions.sockPort}`\n        : ''\n      const chunkPathDevServerWithParams = `${chunkPathDevServer}?${sockHost}${sockPath}${sockPort}`\n      if (!entry.includes(chunkPathDevServerWithParams)) {\n        entry.unshift(chunkPathDevServerWithParams)\n      }\n    }\n\n    if (!entry.includes(chunkPathBasic)) {\n      entry.unshift(chunkPathBasic)\n    }\n  } else {\n    Object.keys(entry).forEach((entryName) => {\n      entry[entryName] = adjustEntry(\n        entry[entryName],\n        enableDevServer,\n        sockOptions,\n      )\n    })\n  }\n\n  return entry\n}\n\nmodule.exports = ErrorOverlayPlugin\n"],"names":[],"mappings":"AAAA,MAAM,sBAAsB,GAAG,OAAO,CAAC,wCAAwC,CAAC,CAAC;AACjF,MAAM,cAAc,GAAG,OAAO,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;AAC9D,MAAM,kBAAkB,GAAG,OAAO,CAAC,OAAO,CAAC,yBAAyB,CAAC,CAAC;AACtE,MAAM,kBAAkB,CAAC;AACzB,EAAE,KAAK,CAAC,QAAQ,EAAE;AAClB,IAAI,IAAI,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC;AACnC,IAAI,MAAM,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;AAC5C,IAAI,IAAI,QAAQ,CAAC,OAAO,CAAC,IAAI,KAAK,aAAa;AAC/C,MAAM,OAAO;AACb,IAAI,MAAM,gBAAgB,GAAG,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC;AAC1D,IAAI,MAAM,WAAW,GAAG,EAAE,CAAC;AAC3B,IAAI,IAAI,gBAAgB,EAAE;AAC1B,MAAM,WAAW,CAAC,QAAQ,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,EAAE,GAAG,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,YAAY,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,QAAQ,KAAK,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC;AACpL,MAAM,WAAW,CAAC,QAAQ,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,EAAE,GAAG,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,YAAY,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,QAAQ,KAAK,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,eAAe,KAAK,QAAQ,KAAK,CAAC,EAAE,GAAG,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,eAAe,CAAC,OAAO,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC;AAC/S,MAAM,WAAW,CAAC,QAAQ,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,EAAE,GAAG,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,YAAY,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,IAAI,KAAK,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC;AAChL,KAAK;AACL,IAAI,QAAQ,CAAC,KAAK,CAAC,WAAW,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC,OAAO,EAAE,KAAK,KAAK;AAClE,MAAM,WAAW,CAAC,KAAK,EAAE,gBAAgB,EAAE,WAAW,CAAC,CAAC;AACxD,KAAK,CAAC,CAAC;AACP,IAAI,QAAQ,CAAC,KAAK,CAAC,cAAc,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC,EAAE,OAAO,EAAE,KAAK;AAClE,MAAM,IAAI,gBAAgB,EAAE;AAC5B,QAAQ,MAAM,+BAA+B,GAAG,OAAO,CAAC,SAAS,CAAC,uBAAuB,CAAC;AAC1F,QAAQ,OAAO,CAAC,SAAS,CAAC,gBAAgB,GAAG,CAAC,WAAW,EAAE,SAAS,KAAK;AACzE,UAAU,IAAI,+BAA+B,EAAE;AAC/C,YAAY,+BAA+B,CAAC,SAAS,CAAC,CAAC;AACvD,WAAW;AACX,UAAU,WAAW,CAAC,OAAO,CAAC,sBAAsB,EAAE,CAAC,CAAC;AACxD,UAAU,OAAO,WAAW,CAAC;AAC7B,SAAS,CAAC;AACV,OAAO;AACP,KAAK,CAAC,CAAC;AACP,GAAG;AACH,CAAC;AACD,SAAS,WAAW,CAAC,KAAK,EAAE,eAAe,EAAE,WAAW,EAAE;AAC1D,EAAE,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;AACjC,IAAI,KAAK,GAAG,CAAC,KAAK,CAAC,CAAC;AACpB,GAAG;AACH,EAAE,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;AAC5B,IAAI,IAAI,eAAe,EAAE;AACzB,MAAM,MAAM,QAAQ,GAAG,WAAW,CAAC,QAAQ,GAAG,CAAC,UAAU,EAAE,WAAW,CAAC,QAAQ,CAAC,CAAC,GAAG,EAAE,CAAC;AACvF,MAAM,MAAM,QAAQ,GAAG,WAAW,CAAC,QAAQ,GAAG,CAAC,UAAU,EAAE,WAAW,CAAC,QAAQ,CAAC,CAAC,GAAG,EAAE,CAAC;AACvF,MAAM,MAAM,QAAQ,GAAG,WAAW,CAAC,QAAQ,GAAG,CAAC,UAAU,EAAE,WAAW,CAAC,QAAQ,CAAC,CAAC,GAAG,EAAE,CAAC;AACvF,MAAM,MAAM,4BAA4B,GAAG,CAAC,EAAE,kBAAkB,CAAC,CAAC,EAAE,QAAQ,CAAC,EAAE,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC;AACrG,MAAM,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,4BAA4B,CAAC,EAAE;AACzD,QAAQ,KAAK,CAAC,OAAO,CAAC,4BAA4B,CAAC,CAAC;AACpD,OAAO;AACP,KAAK;AACL,IAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE;AACzC,MAAM,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;AACpC,KAAK;AACL,GAAG,MAAM;AACT,IAAI,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,CAAC,SAAS,KAAK;AAC9C,MAAM,KAAK,CAAC,SAAS,CAAC,GAAG,WAAW,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,eAAe,EAAE,WAAW,CAAC,CAAC;AACrF,KAAK,CAAC,CAAC;AACP,GAAG;AACH,EAAE,OAAO,KAAK,CAAC;AACf,CAAC;AACD,MAAM,CAAC,OAAO,GAAG,kBAAkB"}